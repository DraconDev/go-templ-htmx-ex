package templates

//go:generate templ generate
templ AdminDashboardContent(user UserInfo) {
	<div class="max-w-6xl mx-auto">
		<!-- Dashboard Header -->
		<div class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-2xl p-8 mb-8">
			<h1 class="text-3xl font-bold mb-2">ğŸ† Admin Dashboard</h1>
			<p class="text-purple-100">Welcome back, { user.Name } - Full administrative access</p>
		</div>
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
			<!-- User Stats Card -->
			<div
				hx-get="/api/admin/analytics"
				hx-target="#user-count"
				hx-swap="innerHTML"
				hx-trigger="load"
				class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100"
			>
				<div class="flex items-center justify-between mb-4">
					<h3 class="text-lg font-semibold text-gray-900">ğŸ‘¥ Total Users</h3>
					<div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
						<span class="text-blue-600 text-lg">ğŸ‘¥</span>
					</div>
				</div>
				<div id="user-count" class="text-3xl font-bold text-gray-900 mb-2">Loading...</div>
				<div class="text-sm text-gray-500">Real database count</div>
			</div>
			<!-- Signups Today Card -->
			<div
				hx-get="/api/admin/analytics"
				hx-target="#signup-count"
				hx-swap="innerHTML"
				hx-trigger="load"
				class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100"
			>
				<div class="flex items-center justify-between mb-4">
					<h3 class="text-lg font-semibold text-gray-900">ğŸ“… Signups Today</h3>
					<div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
						<span class="text-green-600 text-lg">ğŸ“…</span>
					</div>
				</div>
				<div id="signup-count" class="text-3xl font-bold text-gray-900 mb-2">Loading...</div>
				<div class="text-sm text-gray-500">Real daily signups</div>
			</div>
			<!-- Database Status Card -->
			<div
				hx-get="/api/admin/settings"
				hx-target="#db-status"
				hx-swap="innerHTML"
				hx-trigger="load"
				class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100"
			>
				<div class="flex items-center justify-between mb-4">
					<h3 class="text-lg font-semibold text-gray-900">ğŸŸ¢ Database</h3>
					<div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
						<span class="text-green-600 text-lg">ğŸŸ¢</span>
					</div>
				</div>
				<div id="db-status" class="text-lg font-semibold text-gray-900 mb-2">Loading...</div>
				<div class="text-sm text-gray-500">Real database status</div>
			</div>
		</div>
		<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
			<!-- Recent Users -->
			<div
				hx-get="/api/admin/logs"
				hx-target="#recent-users"
				hx-swap="innerHTML"
				hx-trigger="load"
				class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100"
			>
				<h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸ‘¤ Recent Users</h3>
				<div id="recent-users" class="space-y-3">
					<div class="flex items-center justify-center p-8 text-gray-500">
						Loading recent users from database...
					</div>
				</div>
			</div>
			<!-- Quick Actions -->
			<div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100">
				<h3 class="text-lg font-semibold text-gray-900 mb-4">âš¡ Quick Actions</h3>
				<div class="space-y-3">
					<button
						hx-get="/api/admin/analytics"
						hx-target="#admin-content"
						hx-swap="innerHTML"
						class="w-full text-left p-3 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors"
					>
						<div class="flex items-center space-x-3">
							<span class="text-blue-600">ğŸ“Š</span>
							<div>
								<div class="font-medium text-blue-900">View Analytics</div>
								<div class="text-sm text-blue-600">Detailed usage statistics</div>
							</div>
						</div>
					</button>
					<button
						hx-get="/api/admin/settings"
						hx-target="#admin-content"
						hx-swap="innerHTML"
						class="w-full text-left p-3 bg-green-50 hover:bg-green-100 rounded-lg transition-colors"
					>
						<div class="flex items-center space-x-3">
							<span class="text-green-600">âš™ï¸</span>
							<div>
								<div class="font-medium text-green-900">System Settings</div>
								<div class="text-sm text-green-600">Configure application</div>
							</div>
						</div>
					</button>
					<button
						hx-get="/api/admin/logs"
						hx-target="#admin-content"
						hx-swap="innerHTML"
						class="w-full text-left p-3 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors"
					>
						<div class="flex items-center space-x-3">
							<span class="text-purple-600">ğŸ“</span>
							<div>
								<div class="font-medium text-purple-900">View Logs</div>
								<div class="text-sm text-purple-600">System logs and errors</div>
							</div>
						</div>
					</button>
					<button
						hx-get="/"
						hx-swap="none"
						class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors"
					>
						<div class="flex items-center space-x-3">
							<span class="text-gray-600">ğŸ </span>
							<div>
								<div class="font-medium text-gray-900">Back to Home</div>
								<div class="text-sm text-gray-600">Return to main application</div>
							</div>
						</div>
					</button>
				</div>
			</div>
		</div>
		<!-- Content Area for Dynamic Updates -->
		<div id="admin-content" class="mt-8">
			<!-- This area will be updated by HTMX requests -->
		</div>
	</div>
}

<script>
// Process JSON responses and update DOM for admin dashboard
document.addEventListener('htmx:afterRequest', function(evt) {
    if (evt.detail.xhr.getResponseHeader('Content-Type') && 
        evt.detail.xhr.getResponseHeader('Content-Type').includes('application/json')) {
        try {
            const data = JSON.parse(evt.detail.xhr.responseText);
            const targetId = evt.detail.elt.id;
            
            switch(targetId) {
                case 'user-count':
                    updateUserCount(data);
                    break;
                case 'signup-count':
                    updateSignupCount(data);
                    break;
                case 'db-status':
                    updateDBStatus(data);
                    break;
                case 'recent-users':
                    updateRecentUsers(data);
                    break;
            }
        } catch(e) {
            console.error('Error parsing JSON:', e);
        }
    }
});

function updateUserCount(data) {
    const element = document.getElementById('user-count');
    const trendHtml = data.signups_this_week > 0 ? 
        `<div class="text-sm text-green-600 flex items-center"><span class="mr-1">â†—</span>+${data.signups_this_week} this week</div>` : 
        '';
    element.innerHTML = `${data.total_users || 0}${trendHtml}`;
}

function updateSignupCount(data) {
    const element = document.getElementById('signup-count');
    element.innerHTML = `${data.signups_today || 0}`;
}

function updateDBStatus(data) {
    const element = document.getElementById('db-status');
    element.innerHTML = `${data.system_health || 'operational'}`;
}

function updateRecentUsers(data) {
    const container = document.getElementById('recent-users');
    if (data.users && Array.isArray(data.users)) {
        const userHtml = data.users.slice(0, 5).map(user => `
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                        <span class="text-blue-600 text-sm font-medium">${user.name ? user.name.substring(0,2).toUpperCase() : 'UN'}</span>
                    </div>
                    <div>
                        <div class="font-medium text-gray-900">${user.name || 'Unknown User'}</div>
                        <div class="text-sm text-gray-500">${user.email || 'No email'}</div>
                    </div>
                </div>
                <div class="text-sm text-gray-500">${new Date(user.created_at || Date.now()).toLocaleDateString()}</div>
            </div>
        `).join('');
        container.innerHTML = userHtml;
    } else {
        container.innerHTML = '<div class="text-gray-500">No recent users found</div>';
    }
}
</script>
